From d79a6581795044e6ae00eba03eb590e5ed437d42 Mon Sep 17 00:00:00 2001
From: nhatau0105 <anhtuan0105@gmail.com>
Date: Sun, 27 Apr 2014 17:48:45 +0700
Subject: [PATCH] update record

---
 Ameka/AmekaDoc.cpp  |  9 +++++++++
 Ameka/DSPModule.cpp | 18 +++++++++++++++++-
 2 files changed, 26 insertions(+), 1 deletion(-)

diff --git a/Ameka/AmekaDoc.cpp b/Ameka/AmekaDoc.cpp
index b92d715..eae491c 100644
--- a/Ameka/AmekaDoc.cpp
+++ b/Ameka/AmekaDoc.cpp
@@ -97,6 +97,15 @@ CAmekaDoc::~CAmekaDoc()
 	{
 		uint16_t buffer[4] = {0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF};
 		object.Write(buffer, sizeof(buffer));
+		object.SeekToBegin();
+		uint16_t temp[5];
+		temp[0] = (uint16_t)(mDSP.HPFFre * 10);
+		temp[1] = (uint16_t)(mDSP.LPFFre * 10);
+		temp[2] = (uint16_t)(mDSP.epocLength * 10);
+		object.Write(temp, sizeof(temp));
+		CString name;
+		int nLen = mMon->mName.GetLength()*sizeof(TCHAR);
+		object.Write(mMon->mName.GetBuffer(), nLen);
 		object.Close();
 		isOpenFile = FALSE;				
 	}
diff --git a/Ameka/DSPModule.cpp b/Ameka/DSPModule.cpp
index 9444077..74af332 100644
--- a/Ameka/DSPModule.cpp
+++ b/Ameka/DSPModule.cpp
@@ -78,13 +78,29 @@ UINT DSP::DSPThread(LPVOID pParam)
 			else
 			{
 				mDoc->isOpenFile = TRUE;
+				uint16_t temp[40];
+				for (int i=0; i<40; i++)
+				{
+					temp[i] = 0xFF;
+				}
+				mDoc->object.Write(temp, sizeof(temp));
 			}
 		}
 		else if ((mDoc->isRecord == FALSE) && (mDoc->isOpenFile == TRUE))
 		{
+			uint16_t buffer[4] = {0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF};
+			mDoc->object.Write(buffer, sizeof(buffer));
+			mDoc->object.SeekToBegin();
+			uint16_t temp[5];
+			temp[0] = (uint16_t)(mDoc->mDSP.HPFFre * 10);
+			temp[1] = (uint16_t)(mDoc->mDSP.LPFFre * 10);
+			temp[2] = (uint16_t)(mDoc->mDSP.epocLength * 10);
+			mDoc->object.Write(temp, sizeof(temp));
+			CString name;
+			int nLen = mDoc->mMon->mName.GetLength()*sizeof(TCHAR);
+			mDoc->object.Write(mDoc->mMon->mName.GetBuffer(), nLen);
 			mDoc->object.Close();
 			mDoc->isOpenFile = FALSE;
-			
 			/*if (mDoc->isSave != TRUE)
 			{
 				try
-- 
1.8.4.msysgit.0

